# AsterDex å‡€å€¼ç»Ÿè®¡æŠ¥å‘Šç³»ç»Ÿè®¾è®¡

## ä¸€ã€åŠŸèƒ½æ¦‚è¿°

å®šæ—¶é‡‡é›† AsterDex è´¦æˆ·æ•°æ®ï¼Œç”Ÿæˆå‡€å€¼èµ°åŠ¿å›¾è¡¨ï¼Œæ¨é€è‡³ä¼ä¸šå¾®ä¿¡ã€‚

---

## äºŒã€ç»Ÿè®¡æŒ‡æ ‡

### 2.1 èµ„äº§æŒ‡æ ‡

| æŒ‡æ ‡ | å­—æ®µå | æ•°æ®æ¥æº | è¯´æ˜ |
|------|--------|----------|------|
| è´¦æˆ·æƒç›Š | `equity` | totalInitialMargin + availableBalance | è´¦æˆ·æ€»ä»·å€¼ |
| JLP æ•°é‡ | `jlp_amount` | balance API | JLP æŒä»“æ•°é‡ |
| JLP ä»·å€¼ | `jlp_value` | jlp_amount Ã— jlp_price | JLP ç¾å…ƒä»·å€¼ |
| å¯ç”¨ä½™é¢ | `available_balance` | availableBalance | å¯ç”¨äºå¼€ä»“çš„ä½™é¢ |
| å·²ç”¨ä¿è¯é‡‘ | `used_margin` | totalInitialMargin | å·²å ç”¨ä¿è¯é‡‘ |

### 2.2 æ”¶ç›ŠæŒ‡æ ‡

| æŒ‡æ ‡ | è®¡ç®—æ–¹å¼ | è¯´æ˜ |
|------|----------|------|
| ä»Šæ—¥ç›ˆäº | å½“å‰æƒç›Š - ä»Šæ—¥å¼€ç›˜æƒç›Š | ç»å¯¹å€¼ |
| ä»Šæ—¥æ¶¨è·Œå¹… | (å½“å‰ - å¼€ç›˜) / å¼€ç›˜ Ã— 100% | ç™¾åˆ†æ¯” |
| æœ¬å‘¨ç›ˆäº | å½“å‰æƒç›Š - æœ¬å‘¨ä¸€å¼€ç›˜æƒç›Š | ç»å¯¹å€¼ |
| æœ¬å‘¨æ¶¨è·Œå¹… | (å½“å‰ - å‘¨ä¸€) / å‘¨ä¸€ Ã— 100% | ç™¾åˆ†æ¯” |
| ç´¯è®¡ç›ˆäº | å½“å‰æƒç›Š - åˆå§‹æœ¬é‡‘ | éœ€é…ç½®åˆå§‹æœ¬é‡‘ |
| ç´¯è®¡æ”¶ç›Šç‡ | ç´¯è®¡ç›ˆäº / åˆå§‹æœ¬é‡‘ Ã— 100% | ç™¾åˆ†æ¯” |
| å¹´åŒ–æ”¶ç›Šç‡ | ç´¯è®¡æ”¶ç›Šç‡ / è¿è¡Œå¤©æ•° Ã— 365 | é¢„ä¼°å¹´åŒ– |

### 2.3 æŒä»“æŒ‡æ ‡

| æŒ‡æ ‡ | å­—æ®µå | è¯´æ˜ |
|------|--------|------|
| SOL æŒä»“ | `sol_position` | SOL ç©ºå¤´æ•°é‡ |
| ETH æŒä»“ | `eth_position` | ETH ç©ºå¤´æ•°é‡ |
| BTC æŒä»“ | `btc_position` | BTC ç©ºå¤´æ•°é‡ |
| æœªå®ç°ç›ˆäº | `unrealized_pnl` | æ‰€æœ‰æŒä»“æœªå¹³ä»“ç›ˆäº |
| å¯¹å†²æ¯”ä¾‹ | `hedge_ratio` | å½“å‰ä»“ä½ / ç›®æ ‡ä»“ä½ |

### 2.4 é£é™©æŒ‡æ ‡

| æŒ‡æ ‡ | å­—æ®µå | è¯´æ˜ |
|------|--------|------|
| ä¿è¯é‡‘ç‡ | `margin_ratio` | maintMargin / equity (è¶Šä½è¶Šå®‰å…¨) |
| SOL èµ„é‡‘è´¹ç‡ | `sol_funding` | å½“å‰èµ„é‡‘è´¹ç‡ |
| ETH èµ„é‡‘è´¹ç‡ | `eth_funding` | å½“å‰èµ„é‡‘è´¹ç‡ |
| BTC èµ„é‡‘è´¹ç‡ | `btc_funding` | å½“å‰èµ„é‡‘è´¹ç‡ |

---

## ä¸‰ã€æ•°æ®å­˜å‚¨

### 3.1 æ–‡ä»¶ç»“æ„

```
data/
â”œâ”€â”€ equity_history.csv          # å†å²å‡€å€¼è®°å½• (æ¯å°æ—¶)
â”œâ”€â”€ daily_summary.csv           # æ¯æ—¥æ±‡æ€»
â””â”€â”€ charts/                     # ç”Ÿæˆçš„å›¾è¡¨
    â””â”€â”€ equity_chart_2024-12-03.png

config/
â””â”€â”€ accounts.json               # å¤ç”¨ç°æœ‰é…ç½®
```

### 3.2 equity_history.csv æ ¼å¼

```csv
timestamp,account,equity,jlp_amount,jlp_value,available_balance,used_margin,unrealized_pnl,margin_ratio,hedge_ratio,sol_pos,eth_pos,btc_pos,sol_funding,eth_funding,btc_funding
2024-12-03 10:00:00,è´¦æˆ·1,1993.53,468.43,2158.32,234.56,21.44,-2.32,0.0108,0.985,-8.54,-0.068,-0.0038,0.0001,0.00005,0.00008
2024-12-03 11:00:00,è´¦æˆ·1,1996.21,468.43,2162.15,237.23,21.44,-1.85,0.0106,0.985,-8.54,-0.068,-0.0038,0.0001,0.00005,0.00008
```

### 3.3 daily_summary.csv æ ¼å¼

```csv
date,account,open_equity,close_equity,high_equity,low_equity,daily_pnl,daily_pnl_pct,jlp_amount,avg_margin_ratio
2024-12-01,è´¦æˆ·1,1950.00,1980.00,1985.00,1945.00,30.00,1.54,468.43,0.0110
2024-12-02,è´¦æˆ·1,1980.00,1993.53,2000.00,1975.00,13.53,0.68,468.43,0.0108
```

### 3.4 accounts.json æ‰©å±•å­—æ®µ

åœ¨ç°æœ‰ `config/accounts.json` ä¸­æ·»åŠ  `report` é…ç½®ï¼š

```json
{
  "accounts": [...],
  "global": {...},
  "notification": {...},
  "report": {
    "initial_capital": 1800.00,
    "start_date": "2024-11-01",
    "daily_report_hour": 20,
    "hourly_report_enabled": false,
    "alert_daily_loss_threshold": 0.03,
    "alert_margin_ratio_threshold": 0.50
  }
}
```

---

## å››ã€å›¾è¡¨è®¾è®¡

### 4.1 ä¸‰å¼ å‘¨æœŸå›¾è¡¨

ç”Ÿæˆ 3 å¼ ä¸åŒå‘¨æœŸçš„å‡€å€¼èµ°åŠ¿å›¾ï¼š

| å›¾è¡¨ | å‘¨æœŸ | æ•°æ®ç²’åº¦ | ç”¨é€” |
|------|------|----------|------|
| 7å¤©å›¾ | æœ€è¿‘ 7 å¤© | æ¯å°æ—¶ | çŸ­æœŸè¶‹åŠ¿ |
| 30å¤©å›¾ | æœ€è¿‘ 30 å¤© | æ¯æ—¥ | æœˆåº¦è¶‹åŠ¿ |
| 365å¤©å›¾ | æœ€è¿‘ 1 å¹´ | æ¯æ—¥ | é•¿æœŸè¶‹åŠ¿ |

### 4.2 å•å¼ å›¾è¡¨å¸ƒå±€

æ¯å¼ å›¾åŒ…å« 2 ä¸ªå­å›¾ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            AsterDex å‡€å€¼èµ°åŠ¿ - æœ€è¿‘ 7 å¤©                      â”‚
â”‚                    è´¦æˆ·1 | 2024-12-03                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    å‡€å€¼èµ°åŠ¿                          â”‚   â”‚
â”‚  â”‚  $2050 â”¤                         â•­â”€â”€â—                â”‚   â”‚
â”‚  â”‚  $2000 â”¤        â•­â”€â•®    â•­â”€â”€â•®    â•­â”€â•¯                   â”‚   â”‚
â”‚  â”‚  $1950 â”¤   â•­â”€â”€â”€â”€â•¯ â•°â”€â”€â”€â”€â•¯  â•°â”€â”€â”€â”€â•¯                     â”‚   â”‚
â”‚  â”‚  $1900 â”¤â”€â”€â”€â•¯                                         â”‚   â”‚
â”‚  â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚   â”‚
â”‚  â”‚         11/27  11/28  11/29  11/30  12/1  12/2  12/3 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    æ¯æ—¥ç›ˆäº                          â”‚   â”‚
â”‚  â”‚   +$50 â”¤       â–ˆâ–ˆâ–ˆâ–ˆ        â–ˆâ–ˆâ–ˆâ–ˆ                      â”‚   â”‚
â”‚  â”‚   +$25 â”¤  â–ˆâ–ˆâ–ˆâ–ˆ      â–ˆâ–ˆâ–ˆâ–ˆ        â–ˆâ–ˆâ–ˆâ–ˆ  â–ˆâ–ˆâ–ˆâ–ˆ           â”‚   â”‚
â”‚  â”‚     $0 â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€         â”‚   â”‚
â”‚  â”‚   -$25 â”¤                                    â–ˆâ–ˆâ–ˆâ–ˆ     â”‚   â”‚
â”‚  â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚   â”‚
â”‚  â”‚         11/27  11/28  11/29  11/30  12/1  12/2  12/3 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ æœŸé—´æ”¶ç›Š: +$45.67 (+2.35%)  |  æœ€é«˜: $2,050  æœ€ä½: $1,920 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.3 ç”Ÿæˆçš„å›¾ç‰‡æ–‡ä»¶

```
data/charts/
â”œâ”€â”€ equity_7d_2024-12-03.png      # 7å¤©å›¾
â”œâ”€â”€ equity_30d_2024-12-03.png     # 30å¤©å›¾
â””â”€â”€ equity_365d_2024-12-03.png    # 365å¤©å›¾
```

### 4.2 å›¾è¡¨é…è‰²æ–¹æ¡ˆ

| å…ƒç´  | é¢œè‰² | è¯´æ˜ |
|------|------|------|
| å‡€å€¼æ›²çº¿ | #2196F3 (è“è‰²) | ä¸»è‰²è°ƒ |
| ç›ˆåˆ©æŸ±çŠ¶ | #4CAF50 (ç»¿è‰²) | æ­£æ”¶ç›Š |
| äºæŸæŸ±çŠ¶ | #F44336 (çº¢è‰²) | è´Ÿæ”¶ç›Š |
| èƒŒæ™¯ | #FFFFFF (ç™½è‰²) | å¹²å‡€èƒŒæ™¯ |
| ç½‘æ ¼çº¿ | #E0E0E0 (æµ…ç°) | è¾…åŠ©çº¿ |
| æ–‡å­— | #212121 (æ·±ç°) | ä¸»è¦æ–‡å­— |

### 4.3 å›¾è¡¨å°ºå¯¸

- ç»¼åˆå›¾: 1200 Ã— 900 åƒç´ 
- ç®€åŒ–å›¾ (æ•´ç‚¹å¿«æŠ¥): 800 Ã— 400 åƒç´ 

---

## äº”ã€æ¨é€å†…å®¹

### 5.1 æ—¥æŠ¥æ¨é€ (æ¯æ—¥ 20:00)

æ¨é€å†…å®¹ï¼š
1. æ–‡å­—æ‘˜è¦
2. 7 å¤©å‡€å€¼èµ°åŠ¿å›¾
3. 30 å¤©å‡€å€¼èµ°åŠ¿å›¾
4. 365 å¤©å‡€å€¼èµ°åŠ¿å›¾ (å¦‚æœ‰æ•°æ®)

**æ–‡å­—æ¶ˆæ¯ï¼š**

```
ğŸ“Š AsterDex è´¦æˆ·æ—¥æŠ¥
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
è´¦æˆ·: è´¦æˆ·1
æ—¶é—´: 2024-12-03 20:00:00

ğŸ’° èµ„äº§æ¦‚è§ˆ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è´¦æˆ·æƒç›Š    $1,993.53  â”‚
â”‚ JLP æŒä»“    468.43     â”‚
â”‚ JLP ä»·å€¼    $2,158.32  â”‚
â”‚ å¯ç”¨ä½™é¢    $234.56    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ“ˆ æ”¶ç›Šç»Ÿè®¡
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä»Šæ—¥ç›ˆäº    +$13.53    â”‚
â”‚ ä»Šæ—¥æ¶¨å¹…    +0.68%     â”‚
â”‚ æœ¬å‘¨ç›ˆäº    +$45.67    â”‚
â”‚ æœ¬å‘¨æ¶¨å¹…    +2.35%     â”‚
â”‚ ç´¯è®¡ç›ˆäº    +$193.53   â”‚
â”‚ ç´¯è®¡æ”¶ç›Š    +10.75%    â”‚
â”‚ å¹´åŒ–æ”¶ç›Š    +98.5%     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ“Š æŒä»“è¯¦æƒ…
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SOL   -8.54    æœªå®ç°: -$3.21  â”‚
â”‚ ETH   -0.068   æœªå®ç°: +$1.45  â”‚
â”‚ BTC   -0.0038  æœªå®ç°: -$0.56  â”‚
â”‚ å¯¹å†²æ¯”ä¾‹: 98.5%                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

âš ï¸ é£é™©æŒ‡æ ‡
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä¿è¯é‡‘ç‡    1.08%      â”‚
â”‚ SOL è´¹ç‡    0.010%     â”‚
â”‚ ETH è´¹ç‡    0.005%     â”‚
â”‚ BTC è´¹ç‡    0.008%     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
```

**å›¾ç‰‡æ¶ˆæ¯ï¼š** ä¾æ¬¡å‘é€ 3 å¼ å›¾è¡¨ (7å¤©ã€30å¤©ã€365å¤©)

### 5.2 æ•´ç‚¹å¿«æŠ¥ (å¯é€‰)

ç®€åŒ–ç‰ˆæœ¬ï¼Œåªæ¨é€æ–‡å­—ï¼š

```
â° æ•´ç‚¹å¿«æŠ¥ | è´¦æˆ·1 | 12:00
æƒç›Š: $1,993.53 | ä»Šæ—¥: +$13.53 (+0.68%)
```

### 5.3 å¼‚å¸¸å‘Šè­¦

å½“è§¦å‘ä»¥ä¸‹æ¡ä»¶æ—¶ç«‹å³æ¨é€ï¼š

| å‘Šè­¦ç±»å‹ | è§¦å‘æ¡ä»¶ | æ¶ˆæ¯ç¤ºä¾‹ |
|----------|----------|----------|
| å¤§å¹…äºæŸ | å•æ—¥äºæŸ > 3% | âš ï¸ è´¦æˆ·1 ä»Šæ—¥äºæŸ -3.5%ï¼Œè¯·å…³æ³¨ï¼ |
| ä¿è¯é‡‘ä¸è¶³ | ä¿è¯é‡‘ç‡ > 50% | ğŸš¨ è´¦æˆ·1 ä¿è¯é‡‘ç‡ 52%ï¼Œé£é™©è¾ƒé«˜ï¼ |
| å¯¹å†²åç¦» | å¯¹å†²æ¯”ä¾‹ < 80% | âš ï¸ è´¦æˆ·1 å¯¹å†²æ¯”ä¾‹ 75%ï¼Œåå·®è¾ƒå¤§ï¼ |

---

## å…­ã€æŠ€æœ¯å®ç°

### 6.1 æ–‡ä»¶ç»“æ„

```
scripts/
â”œâ”€â”€ equity_reporter/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ collector.py        # æ•°æ®é‡‡é›†
â”‚   â”œâ”€â”€ storage.py          # CSV å­˜å‚¨
â”‚   â”œâ”€â”€ calculator.py       # æŒ‡æ ‡è®¡ç®—
â”‚   â”œâ”€â”€ chart_generator.py  # å›¾è¡¨ç”Ÿæˆ
â”‚   â”œâ”€â”€ notifier.py         # ä¼ä¸šå¾®ä¿¡æ¨é€
â”‚   â””â”€â”€ config.py           # é…ç½®ç®¡ç†
â”œâ”€â”€ run_hourly_collect.py   # æ¯å°æ—¶é‡‡é›† (cron)
â”œâ”€â”€ run_daily_report.py     # æ—¥æŠ¥æ¨é€ (cron)
â””â”€â”€ run_alert_check.py      # å¼‚å¸¸æ£€æŸ¥ (cron)
```

### 6.2 ä¾èµ–åº“

```
pandas          # æ•°æ®å¤„ç†
matplotlib      # å›¾è¡¨ç”Ÿæˆ
seaborn         # å›¾è¡¨ç¾åŒ– (å¯é€‰)
httpx           # HTTP è¯·æ±‚
Pillow          # å›¾ç‰‡å¤„ç†
```

### 6.3 å®šæ—¶ä»»åŠ¡ (cron)

```bash
# æ¯å°æ—¶é‡‡é›†æ•°æ® (æ•´ç‚¹)
0 * * * * cd /path/to/project && python scripts/run_hourly_collect.py

# æ¯æ—¥ 20:00 æ¨é€æ—¥æŠ¥
0 20 * * * cd /path/to/project && python scripts/run_daily_report.py

# æ¯ 10 åˆ†é’Ÿæ£€æŸ¥å¼‚å¸¸
*/10 * * * * cd /path/to/project && python scripts/run_alert_check.py
```

### 6.4 æ ¸å¿ƒç±»è®¾è®¡

```python
class EquityCollector:
    """æ•°æ®é‡‡é›†å™¨"""
    async def collect() -> EquitySnapshot
    async def collect_all_accounts() -> List[EquitySnapshot]

class EquityStorage:
    """CSV å­˜å‚¨"""
    def append_record(snapshot: EquitySnapshot)
    def get_history(days: int) -> pd.DataFrame
    def get_daily_summary(days: int) -> pd.DataFrame
    def update_daily_summary()

class EquityCalculator:
    """æŒ‡æ ‡è®¡ç®—"""
    def calc_daily_pnl(df: pd.DataFrame) -> dict
    def calc_weekly_pnl(df: pd.DataFrame) -> dict
    def calc_cumulative_pnl(current: float, initial: float) -> dict
    def calc_annualized_return(cumulative_pct: float, days: int) -> float

class ChartGenerator:
    """å›¾è¡¨ç”Ÿæˆ"""
    def generate_equity_chart(df: pd.DataFrame) -> bytes
    def generate_daily_pnl_chart(df: pd.DataFrame) -> bytes
    def generate_comprehensive_chart(df: pd.DataFrame, summary: dict) -> bytes

class WeChatNotifier:
    """ä¼ä¸šå¾®ä¿¡æ¨é€"""
    def send_text(content: str)
    def send_image(image_bytes: bytes)
    def send_daily_report(summary: dict, chart: bytes)
```

---

## ä¸ƒã€é…ç½®é¡¹

### 7.1 accounts.json å®Œæ•´ç¤ºä¾‹

ç›´æ¥å¤ç”¨ç°æœ‰é…ç½®æ–‡ä»¶ `config/accounts.json`ï¼Œæ·»åŠ  `report` å­—æ®µï¼š

```json
{
  "accounts": [
    {
      "name": "è´¦æˆ·1",
      "enabled": true,
      "asterdex": {
        "chain": "solana",
        "user_address": "xxx",
        "api_key": "xxx",
        "api_secret": "xxx"
      },
      "trading": {...}
    }
  ],
  "global": {
    "hedge_api_url": "http://localhost:3000",
    "rebalance_interval": 600,
    ...
  },
  "notification": {
    "enabled": true,
    "wechat_webhook": "https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=xxx"
  },
  "report": {
    "initial_capital": 1800.00,
    "start_date": "2024-11-01",
    "daily_report_hour": 20,
    "hourly_report_enabled": false,
    "history_days": 7,
    "alert_enabled": true,
    "alert_daily_loss_threshold": 0.03,
    "alert_margin_ratio_threshold": 0.50,
    "alert_hedge_ratio_threshold": 0.80
  }
}
```

### 7.2 é…ç½®è¯´æ˜

| å­—æ®µ | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|------|------|--------|------|
| `initial_capital` | float | å¿…å¡« | åˆå§‹æœ¬é‡‘ (USD) |
| `start_date` | string | å¿…å¡« | å¼€å§‹æ—¥æœŸ (YYYY-MM-DD) |
| `daily_report_hour` | int | 20 | æ—¥æŠ¥æ¨é€æ—¶é—´ (å°æ—¶) |
| `hourly_report_enabled` | bool | false | æ˜¯å¦å¯ç”¨æ•´ç‚¹å¿«æŠ¥ |
| `history_days` | int | 7 | å›¾è¡¨å±•ç¤ºå¤©æ•° |
| `alert_enabled` | bool | true | æ˜¯å¦å¯ç”¨å¼‚å¸¸å‘Šè­¦ |
| `alert_daily_loss_threshold` | float | 0.03 | æ—¥äºæŸå‘Šè­¦é˜ˆå€¼ (3%) |
| `alert_margin_ratio_threshold` | float | 0.50 | ä¿è¯é‡‘ç‡å‘Šè­¦é˜ˆå€¼ (50%) |
| `alert_hedge_ratio_threshold` | float | 0.80 | å¯¹å†²æ¯”ä¾‹å‘Šè­¦é˜ˆå€¼ (80%) |

---

## å…«ã€æ‰©å±•åŠŸèƒ½ (å¯é€‰)

### 8.1 Web ä»ªè¡¨ç›˜

ä½¿ç”¨ Flask/FastAPI æ­å»ºç®€å• Web é¡µé¢ï¼š
- å®æ—¶å‡€å€¼å±•ç¤º
- å†å²èµ°åŠ¿æŸ¥çœ‹
- æ‰‹åŠ¨è§¦å‘æŠ¥å‘Š

### 8.2 å¤šè´¦æˆ·æ±‡æ€»

æ”¯æŒå¤šä¸ªè´¦æˆ·çš„æ±‡æ€»ç»Ÿè®¡ï¼š
- æ€»æƒç›Š
- æ€»ç›ˆäº
- å„è´¦æˆ·å æ¯”

### 8.3 å¯¼å‡º Excel

æ”¯æŒå¯¼å‡º Excel æ ¼å¼çš„è¯¦ç»†æŠ¥è¡¨ï¼ŒåŒ…å«ï¼š
- æ¯æ—¥æ˜ç»†
- æœˆåº¦æ±‡æ€»
- å¹´åº¦ç»Ÿè®¡

---

## ä¹ã€ç¤ºä¾‹è¾“å‡º

### 9.1 æ—¥æŠ¥å›¾è¡¨ç¤ºä¾‹

![æ—¥æŠ¥å›¾è¡¨](./charts/example_daily_report.png)

*æ³¨: å®é™…å›¾è¡¨å°†åœ¨å®ç°åç”Ÿæˆ*

### 9.2 CSV æ•°æ®ç¤ºä¾‹

**equity_history.csv:**
```csv
timestamp,account,equity,jlp_amount,jlp_value,available_balance,used_margin,unrealized_pnl,margin_ratio,hedge_ratio,sol_pos,eth_pos,btc_pos,sol_funding,eth_funding,btc_funding
2024-12-03 08:00:00,è´¦æˆ·1,1985.32,468.43,2150.21,230.12,21.44,-3.45,0.0108,0.982,-8.54,-0.068,-0.0038,0.0001,0.00005,0.00008
2024-12-03 09:00:00,è´¦æˆ·1,1988.76,468.43,2153.67,232.45,21.44,-2.98,0.0107,0.983,-8.54,-0.068,-0.0038,0.0001,0.00005,0.00008
2024-12-03 10:00:00,è´¦æˆ·1,1993.53,468.43,2158.32,234.56,21.44,-2.32,0.0108,0.985,-8.54,-0.068,-0.0038,0.0001,0.00005,0.00008
```

---

## åã€å®ç°è®¡åˆ’

| é˜¶æ®µ | å†…å®¹ | ä¼˜å…ˆçº§ |
|------|------|--------|
| Phase 1 | æ•°æ®é‡‡é›† + CSV å­˜å‚¨ | P0 |
| Phase 2 | æŒ‡æ ‡è®¡ç®— + æ–‡å­—æŠ¥å‘Š | P0 |
| Phase 3 | å›¾è¡¨ç”Ÿæˆ | P0 |
| Phase 4 | ä¼ä¸šå¾®ä¿¡æ¨é€ | P0 |
| Phase 5 | å¼‚å¸¸å‘Šè­¦ | P1 |
| Phase 6 | æ•´ç‚¹å¿«æŠ¥ | P2 |
| Phase 7 | Web ä»ªè¡¨ç›˜ | P3 |

---

## åä¸€ã€FAQ

**Q1: åˆå§‹æœ¬é‡‘å¦‚ä½•è®¾ç½®ï¼Ÿ**
A: åœ¨ `config/accounts.json` çš„ `report.initial_capital` å­—æ®µé…ç½®ã€‚

**Q2: å¦‚ä½•æ·»åŠ æ–°è´¦æˆ·ï¼Ÿ**
A: åœ¨ `config/accounts.json` çš„ `accounts` æ•°ç»„ä¸­æ·»åŠ æ–°è´¦æˆ·é…ç½®ã€‚

**Q3: å¦‚ä½•æ‰‹åŠ¨è§¦å‘æŠ¥å‘Šï¼Ÿ**
A: è¿è¡Œ `python scripts/run_daily_report.py --now`

**Q4: CSV æ–‡ä»¶è¿‡å¤§æ€ä¹ˆåŠï¼Ÿ**
A: å¯å®šæœŸå½’æ¡£æ—§æ•°æ®ï¼Œä¾‹å¦‚æŒ‰æœˆä»½åˆ†å‰²æ–‡ä»¶ã€‚

**Q5: ä¼ä¸šå¾®ä¿¡ webhook ä»å“ªè¯»å–ï¼Ÿ**
A: å¤ç”¨ `config/accounts.json` çš„ `notification.wechat_webhook` å­—æ®µã€‚
