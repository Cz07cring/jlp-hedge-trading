# 再平衡策略对比分析

## 策略方案总览

| 方案 | 检测频率 | 触发条件 | 价格基准 |
|------|----------|----------|----------|
| A. 固定时间 | 每 10 分钟 | 固定触发 | 实时价格 |
| B. 紧凑阈值 | 每 1 分钟 | 偏离 > 1.5-2% | 实时价格 |
| C. 均价阈值 | 每 1 分钟 | 偏离 > 1.5-2% | 30分钟均价 |
| D. 混合策略 | 每 1 分钟 | 常规用均价，紧急用实时 | 混合 |

---

## 方案 A：固定 10 分钟调仓

### 逻辑
```
每 10 分钟 → 计算偏离 → 无论大小都调仓
```

### 优点
| 优点 | 说明 |
|------|------|
| ✅ 简单可靠 | 逻辑最简单，不容易出 bug |
| ✅ 稳定预期 | 调仓频率固定，成本可预测 |
| ✅ 无需历史数据 | 不需要存储价格历史 |
| ✅ 实现成本低 | 代码改动最小 |

### 缺点
| 缺点 | 说明 |
|------|------|
| ❌ 可能过度调仓 | 偏离只有 0.1% 也会调仓，浪费手续费 |
| ❌ 可能调仓不足 | 9 分钟内出现大偏离，要等到下个周期 |
| ❌ 无视市场状态 | 不管波动大小，都是固定频率 |

### 成本估算（$15,000 本金）
```
每 10 分钟调仓 1 次
年调仓次数 = 365 × 24 × 6 = 52,560 次
假设每次调整 5% 仓位（$525），Maker 0.02%
年成本 = 52,560 × $525 × 0.02% = $5,519 ❌ 太高
```

**优化**：加最小偏离阈值（如 0.5%），减少无效调仓
```
假设 50% 的检测偏离 < 0.5%，跳过
有效调仓 = 26,280 次
年成本 = 26,280 × $525 × 0.02% = $2,759 仍然偏高
```

---

## 方案 B：紧凑阈值（实时价格）

### 逻辑
```
每 1 分钟检测 → 偏离 > 2% 才调仓
```

### 优点
| 优点 | 说明 |
|------|------|
| ✅ 精确控制敞口 | 只在偏离超阈值时调仓 |
| ✅ 快速响应 | 1 分钟检测，及时发现大偏离 |
| ✅ 成本可控 | 不浪费手续费在小偏离上 |

### 缺点
| 缺点 | 说明 |
|------|------|
| ❌ 价格噪音敏感 | 瞬时价格波动可能触发不必要的调仓 |
| ❌ 来回调仓风险 | 价格在阈值附近震荡，可能频繁触发 |
| ❌ 滑点放大 | 瞬时价格可能偏离成交价 |

### 成本估算
```
假设每天触发 2-3 次调仓
年调仓次数 = 365 × 2.5 = 912 次
年成本 = 912 × $1,050 × 0.02% = $192
```

### 来回调仓问题示例
```
时间   价格    偏离    动作
10:00  $230   +1.8%   -
10:01  $232   +2.1%   调仓（加空）
10:02  $228   +1.5%   -
10:03  $226   +0.9%   -
10:04  $229   +1.9%   -
10:05  $231   +2.2%   调仓（又触发！）
```

---

## 方案 C：均价阈值（30分钟均价）

### 逻辑
```
每 1 分钟检测 → 用 30 分钟均价计算偏离 → 偏离 > 2% 才调仓
```

### 优点
| 优点 | 说明 |
|------|------|
| ✅ 过滤噪音 | 均价平滑短期波动 |
| ✅ 减少来回调仓 | 不会因瞬时波动频繁触发 |
| ✅ 更稳定的基准 | 调仓基于趋势而非瞬时 |

### 缺点
| 缺点 | 说明 |
|------|------|
| ❌ 响应滞后 | 极端行情下，均价反应慢 |
| ❌ 实现复杂 | 需要存储和维护价格历史 |
| ❌ 冷启动问题 | 启动时没有历史数据 |
| ❌ 均价失真风险 | 单边行情中，均价可能显著落后 |

### 极端行情问题示例
```
时间   实时价格   30分钟均价   实际偏离   均价偏离   动作
10:00  $230      $228        +2%       +1.1%     -
10:01  $235      $228.5      +4%       +1.3%     - (没触发!)
10:02  $240      $229        +6%       +1.5%     - (没触发!)
10:03  $245      $230        +8%       +2.1%     调仓（太晚了）
```

---

## 方案 D：混合策略

### 逻辑
```
每 1 分钟检测：
  - 常规判断：用 30 分钟均价，偏离 > 2% 调仓
  - 紧急判断：用实时价格，偏离 > 5% 立即调仓
```

### 优点
| 优点 | 说明 |
|------|------|
| ✅ 兼顾稳定和响应 | 常规用均价稳定，紧急用实时快速 |
| ✅ 减少噪音触发 | 小波动被均价过滤 |
| ✅ 极端行情保护 | 大偏离直接用实时价格触发 |

### 缺点
| 缺点 | 说明 |
|------|------|
| ❌ 实现最复杂 | 需要维护两套价格、两套阈值 |
| ❌ 参数调优难 | 均价窗口、两套阈值都需要调优 |
| ❌ 测试成本高 | 需要覆盖多种场景 |
| ❌ 可能有边界问题 | 两套逻辑的交界处可能有冲突 |

---

## 客观对比总结

### 复杂度 vs 效果

```
效果
  ↑
  │            D(混合)
  │        C(均价)  B(紧凑)
  │
  │  A(固定10分钟+阈值)
  │
  └─────────────────────→ 复杂度
```

### 各方案评分（1-5分）

| 维度 | A.固定10分钟 | B.紧凑实时 | C.均价阈值 | D.混合 |
|------|-------------|-----------|-----------|--------|
| 实现简单度 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐ |
| 成本控制 | ⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐ |
| 敞口控制 | ⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| 极端行情响应 | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐ | ⭐⭐⭐⭐ |
| 稳定性 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐ |
| 可维护性 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐ |

### 成本对比（年化，$15,000 本金）

| 方案 | 年调仓次数 | 年成本 | 成本率 |
|------|-----------|--------|--------|
| A. 固定10分钟（无阈值） | 52,560 | $5,519 | 36.8% ❌ |
| A. 固定10分钟（+1%阈值） | ~3,000 | $630 | 4.2% |
| B. 紧凑实时（2%阈值） | ~900 | $189 | 1.26% |
| C. 均价阈值（2%阈值） | ~600 | $126 | 0.84% |
| D. 混合策略 | ~700 | $147 | 0.98% |

---

## 推荐建议

### 按需求选择

| 你的需求 | 推荐方案 |
|----------|----------|
| 追求简单可靠 | **A. 固定 10 分钟 + 1% 阈值** |
| 追求成本最低 | **C. 均价阈值** |
| 追求敞口最小 | **B. 紧凑实时** |
| 追求综合最优 | **D. 混合策略** |
| 先跑起来再优化 | **A 或 B** |

### 我的建议

**第一阶段**：先用 **方案 A（固定 10 分钟 + 1% 阈值）**
- 简单可靠，容易实现
- 可以快速上线验证
- 收集真实数据

**第二阶段**：根据数据优化
- 分析实际调仓频率和偏离分布
- 再决定是否升级到 B/C/D

---

## 方案 A 优化版（推荐先实现）

```yaml
rebalance:
  check_interval_seconds: 600    # 10 分钟检测
  thresholds:
    asset_pct: 1.0               # 单资产偏离 > 1% 才调仓
    total_pct: 1.0               # 总敞口偏离 > 1% 才调仓
  emergency:
    asset_pct: 5.0               # 紧急阈值（可选，需要更频繁检测）
    total_pct: 3.0
  min_order_sizes:
    SOL: 0.05
    ETH: 0.005
    BTC: 0.0005
```

**预期效果**：
- 年调仓次数: ~3,000 次
- 年成本: ~$630（4.2%）
- 平均敞口: < 2%
- 最大敞口: < 5%（两个 10 分钟周期间）

**优点**：简单、稳定、可预测
**缺点**：极端行情响应慢（最多等 10 分钟）

---

## 结论

**没有完美的方案，只有适合的方案。**

1. 如果你追求**简单稳定**，先用 **固定 10 分钟 + 1% 阈值**
2. 如果你追求**精确对冲**，用 **紧凑实时（1分钟 + 2%阈值）**
3. 均价和混合策略理论更优，但实现复杂，建议后期优化

建议：**先用简单方案跑起来，收集数据后再优化。**
